<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chat Attrape-Souris</title>
  <!-- Inclusion de p5.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <!-- Inclusion du fichier objects.js (tr√®s important !) -->
  <script src="objects.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0; 
      padding: 0;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #def; /* Fond bleu clair */
    }
    h1 {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Chat Attrape-Souris üê±</h1>
  <p>D√©placez le chat avec la souris pour attraper les souris et √©viter les autres objets !</p>
  <p id="score">Score : 0</p>
  <p id="errors">Erreurs : 0</p>

  <script>
    /* ------------------------------------------------------------------
       Variables du jeu
       ------------------------------------------------------------------ */
    let fallingObjects = [];
    let score = 0;
    let errors = 0;
    const MAX_ERRORS = 10;

    /* ------------------------------------------------------------------
       p5.js : setup
       ------------------------------------------------------------------ */
    function setup() {
      createCanvas(800, 600);
      frameRate(30);
      noCursor(); // Masquer le curseur pour mieux voir le chat

      // Charger les images (chat, souris, pomme, chaussure) avant de cr√©er les objets
      preloadImages(() => {
        // G√©n√©rer quelques √©l√©ments tombants une fois les images pr√™tes
        for (let i = 0; i < 6; i++) {
          fallingObjects.push({
            x: random(width),
            y: random(-height, 0),
            type: random(['mouse', 'object']),
            img: random(objects),
            speed: random(2, 5),
          });
        }
      });
    }

    /* ------------------------------------------------------------------
       p5.js : draw
       ------------------------------------------------------------------ */
    function draw() {
      // Si les images ne sont pas encore charg√©es, on affiche un message "Chargement‚Ä¶"
      if (!isLoaded) {
        background(200);
        textSize(24);
        textAlign(CENTER, CENTER);
        fill(0);
        text("Chargement des ressources...", width / 2, height / 2);
        return;
      }

      // Fond gris clair
      background(220);

      // Afficher le chat en bas, centr√© sur la souris
      image(cat, mouseX - 50, height - 100, 100, 100);

      // Mise √† jour des objets tombants
      for (let obj of fallingObjects) {
        // Souris ou objet ?
        if (obj.type === 'mouse') {
          image(mouse, obj.x, obj.y, 50, 50);
        } else {
          image(obj.img, obj.x, obj.y, 50, 50);
        }

        // Faire tomber l‚Äôobjet
        obj.y += obj.speed;

        // R√©initialiser si l'objet sort de l'√©cran
        if (obj.y > height) {
          resetFallingObject(obj);
        }

        // V√©rifier la collision avec le chat
        if (
          obj.y > height - 150 &&  // environ la hauteur du chat
          obj.x > mouseX - 50 &&   // limite gauche du chat
          obj.x < mouseX + 50      // limite droite du chat
        ) {
          if (obj.type === 'mouse') {
            score++;
            console.log("Miaou !");
          } else {
            errors++;
            console.log("Feule !");
          }

          // Mettre √† jour l'affichage
          document.getElementById('score').textContent  = `Score : ${score}`;
          document.getElementById('errors').textContent = `Erreurs : ${errors}`;

          resetFallingObject(obj);
        }
      }

      // V√©rifier si on a atteint la limite d'erreurs
      if (errors >= MAX_ERRORS) {
        noLoop();
        textSize(32);
        textAlign(CENTER, CENTER);
        fill(255, 0, 0);
        text("Game Over !", width / 2, height / 2);
      }
    }

    /* ------------------------------------------------------------------
       R√©initialiser un objet
       ------------------------------------------------------------------ */
    function resetFallingObject(obj) {
      obj.x = random(width);
      obj.y = random(-height, 0);
      obj.type = random(['mouse', 'object']);
      obj.img = random(objects);
      obj.speed = random(2, 5);
    }
  </script>
</body>
</html>
