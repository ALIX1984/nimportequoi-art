<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Attrape-Souris</title>
  <!-- Inclure p5.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <!-- Inclure le fichier objects.js -->
  <script src="objects.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #def; /* Fond bleu clair */
    }
    h1 {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Chat Attrape-Souris üê±</h1>
  <p>D√©place la souris pour bouger le chat, attrapez les souris et √©vitez les objets !</p>
  <p id="score">Score : 0</p>
  <p id="errors">Erreurs : 0</p>

  <script>
    let fallingObjects = [];
    let score = 0;
    let errors = 0;
    const MAX_ERRORS = 10;

    function setup() {
      createCanvas(800, 600);
      frameRate(30);
      noCursor();

      preloadImages(() => {
        for (let i = 0; i < 6; i++) {
          fallingObjects.push({
            x: random(width),
            y: random(-height, 0),
            type: random(['mouse', 'object']),
            img: random(objects),
            speed: random(2, 5)
          });
        }
        loop(); // D√©marrer le dessin une fois les images charg√©es
      });
    }

    function draw() {
      if (!isLoaded) {
        background(200);
        textSize(32);
        textAlign(CENTER, CENTER);
        fill(0);
        text("Chargement...", width / 2, height / 2);
        return;
      }

      background(220);

      // Afficher le chat en bas, centr√© sur la souris
      image(cat, mouseX - 50, height - 100, 100, 100);

      for (let obj of fallingObjects) {
        image(obj.type === 'mouse' ? mouse : obj.img, obj.x, obj.y, 50, 50);
        obj.y += obj.speed;

        if (obj.y > height) resetFallingObject(obj);

        if (
          obj.y > height - 150 &&
          obj.x > mouseX - 50 &&
          obj.x < mouseX + 50
        ) {
          if (obj.type === 'mouse') {
            score++;
            playSound('mew');
          } else {
            errors++;
            playSound('hiss');
          }

          document.getElementById('score').textContent = `Score : ${score}`;
          document.getElementById('errors').textContent = `Erreurs : ${errors}`;
          resetFallingObject(obj);
        }
      }

      if (errors >= MAX_ERRORS) {
        noLoop();
        textSize(32);
        textAlign(CENTER, CENTER);
        fill(255, 0, 0);
        text('Game Over !', width / 2, height / 2);
      }
    }

    function resetFallingObject(obj) {
      obj.x = random(width);
      obj.y = random(-height, 0);
      obj.type = random(['mouse', 'object']);
      obj.img = random(objects);
      obj.speed = random(2, 5);
    }

    function playSound(type) {
      console.log(type === 'mew' ? 'Miaou !' : 'Feule !');
    }
  </script>
</body>
</html>
