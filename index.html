<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chat Attrape-Souris</title>
  <!-- Inclusion de p5.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <!-- Inclusion du fichier objects.js -->
  <script src="objects.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0; 
      padding: 0;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #def; /* l√©ger fond bleu clair */
    }
    h1 {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Chat Attrape-Souris üê±</h1>
  <p>D√©placez le chat avec la souris pour attraper les souris et √©viter les autres objets !</p>
  <p id="score">Score : 0</p>
  <p id="errors">Erreurs : 0</p>

  <script>
    let fallingObjects = [];
    let score = 0;
    let errors = 0;
    const MAX_ERRORS = 10;

    function setup() {
      createCanvas(800, 600);
      frameRate(30);
      noCursor(); // Masquer le curseur pour mieux voir le chat

      // V√©rifier si les images sont charg√©es avant de commencer
      preloadImages(() => {
        // G√©n√©rer des √©l√©ments tombants une fois les images pr√™tes
        for (let i = 0; i < 6; i++) {
          fallingObjects.push({
            x: random(width),
            y: random(-height, 0),
            type: random(['mouse', 'object']),
            img: random(objects),
            speed: random(2, 5),
          });
        }
      });
    }

    function draw() {
      if (!isLoaded) {
        background(200);
        textAlign(CENTER, CENTER);
        textSize(24);
        text("Chargement des ressources...", width / 2, height / 2);
        return;
      }

      background(220);

      // Afficher le chat en bas, centr√© sur la souris
      image(cat, mouseX - 50, height - 100, 100, 100);

      // Mettre √† jour les √©l√©ments tombants
      for (let obj of fallingObjects) {
        // Affichage
        if (obj.type === 'mouse') {
          image(mouse, obj.x, obj.y, 50, 50);
        } else {
          image(obj.img, obj.x, obj.y, 50, 50);
        }

        // Faire tomber l‚Äôobjet
        obj.y += obj.speed;

        // R√©initialiser si on sort de l'√©cran
        if (obj.y > height) {
          resetFallingObject(obj);
        }

        // V√©rifier collision avec le chat
        if (
          obj.y > height - 150 && // environ la hauteur du chat
          obj.x > mouseX - 50 && // limite gauche
          obj.x < mouseX + 50 // limite droite
        ) {
          if (obj.type === 'mouse') {
            score++;
            console.log("Miaou !");
          } else {
            errors++;
            console.log("Feule !");
          }

          // Mise √† jour du scoreboard
          document.getElementById('score').textContent = `Score : ${score}`;
          document.getElementById('errors').textContent = `Erreurs : ${errors}`;

          // On renvoie l'objet en haut
          resetFallingObject(obj);
        }
      }

      // Game Over ?
      if (errors >= MAX_ERRORS) {
        noLoop();
        textSize(32);
        textAlign(CENTER, CENTER);
        fill(255, 0, 0);
        text("Game Over !", width / 2, height / 2);
      }
    }

    function resetFallingObject(obj) {
      obj.x = random(width);
      obj.y = random(-height, 0);
      obj.type = random(['mouse', 'object']);
      obj.img = random(objects);
      obj.speed = random(2, 5);
    }
  </script>
</body>
</html>

