<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apprends avec les Lettres ðŸ–¤ðŸŽ¨</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background-color: #f0f8ff;
    }
    canvas {
      display: block;
      margin: 0 auto;
    }
    h1 {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Apprends avec les Lettres ðŸ–¤ðŸŽ¨</h1>
  <script>
    let wordCategories = {
      animaux: ["chien", "chat", "oiseau", "serpent", "cheval", "poisson", "lapin", "chÃ¨vre", "vache", "singe"],
      maison: ["table", "chaise", "lampe", "rideau", "lit", "porte", "fenÃªtre", "canapÃ©", "frigo", "four"],
      ecole: ["crayon", "stylo", "gomme", "trousse", "livre", "tableau", "cahier", "rÃ¨gle", "cartable", "feutre"],
      nature: ["arbre", "fleur", "herbe", "montagne", "riviÃ¨re", "nuage", "pluie", "soleil", "lune", "Ã©toile"]
    };

    let fallingLetters = [];
    let currentWord = "";
    let wordArray = [];
    let letterSize = 30;
    let collectedLetters = [];
    let letterColors = [];
    let fireworks = [];
    let gameState = "playing";
    let categories = Object.keys(wordCategories);
    let categoryIndex = 0;
    let music;

    function preload() {
      music = loadSound('https://freesound.org/data/previews/616/616192_5674468-lq.mp3');
    }

    function setup() {
      createCanvas(800, 600);
      textAlign(CENTER, CENTER);
      rectMode(CENTER);

      music.loop();
      resetGame();
    }

    function draw() {
      background(240);

      // Afficher le mot en bas
      for (let i = 0; i < wordArray.length; i++) {
        fill(collectedLetters.includes(wordArray[i]) ? letterColors[i] : 0);
        text(wordArray[i], width / 2 - (wordArray.length * letterSize) / 2 + i * letterSize, height - 50);
      }

      // GÃ©rer les lettres qui tombent
      for (let i = fallingLetters.length - 1; i >= 0; i--) {
        let letter = fallingLetters[i];
        fill(letter.color);
        text(letter.char, letter.x, letter.y);
        letter.y += letter.speed;

        if (dist(mouseX, height - 50, letter.x, letter.y) < letterSize / 2) {
          fallingLetters.splice(i, 1);
          if (wordArray.includes(letter.char)) {
            collectedLetters.push(letter.char);
            if (collectedLetters.length === wordArray.length && arraysEqual(collectedLetters, wordArray)) {
              gameState = "won";
              music.stop();
              triggerFireworks();
              setTimeout(resetGame, 3000);
            }
          }
        } else if (letter.y > height) {
          fallingLetters.splice(i, 1);
        }
      }

      // GÃ©rer les feux d'artifice
      for (let i = fireworks.length - 1; i >= 0; i--) {
        let fw = fireworks[i];
        fw.show();
        fw.update();
        if (fw.done()) fireworks.splice(i, 1);
      }

      if (gameState === "won") {
        textSize(40);
        fill(0);
        text("Bravo ! ðŸŽ‰", width / 2, height / 2);
      }
    }

    function resetGame() {
      gameState = "playing";
      collectedLetters = [];
      letterColors = [];
      fallingLetters = [];
      currentWord = getNextWord();
      wordArray = currentWord.split("");

      for (let i = 0; i < wordArray.length; i++) {
        letterColors.push(color(random(255), random(255), random(255)));
      }

      spawnLetters();
    }

    function getNextWord() {
      let category = categories[categoryIndex];
      categoryIndex = (categoryIndex + 1) % categories.length;
      return random(wordCategories[category]);
    }

    function spawnLetters() {
      for (let i = 0; i < 20; i++) {
        let char = random(currentWord.split("").concat(random("abcdefghijklmnopqrstuvwxyz")));
        fallingLetters.push({
          char: char,
          x: random(width),
          y: random(-300, -50),
          speed: random(2, 5),
          color: color(random(255), random(255), random(255))
        });
      }
    }

    function arraysEqual(a, b) {
      return JSON.stringify(a) === JSON.stringify(b);
    }

    class Firework {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.particles = [];
        for (let i = 0; i < 100; i++) {
          this.particles.push(new Particle(x, y));
        }
      }

      show() {
        for (let p of this.particles) {
          p.show();
        }
      }

      update() {
        for (let p of this.particles) {
          p.update();
        }
      }

      done() {
        return this.particles.every(p => p.done());
      }
    }

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.vx = random(-2, 2);
        this.vy = random(-2, 2);
        this.alpha = 255;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.alpha -= 5;
      }

      done() {
        return this.alpha <= 0;
      }

      show() {
        noStroke();
        fill(255, this.alpha);
        ellipse(this.x, this.y, 5);
      }
    }

    function triggerFireworks() {
      for (let i = 0; i < 5; i++) {
        fireworks.push(new Firework(random(width), random(height / 2)));
      }
    }
  </script>
</body>
</html>

