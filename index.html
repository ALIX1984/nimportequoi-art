<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Apprends avec les Lettres ðŸ–¤ðŸŽ¨</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <!-- p5.sound (optionnel si tu veux des sons) -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js-sound/1.6.0/p5.sound.min.js"></script>-->
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f8ff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 0 auto;
    }
    h1 {
      margin: 1rem 0 0.5rem;
    }
    p {
      margin: 0 0 1rem;
    }
  </style>
</head>
<body>
  <h1>Apprends avec les Lettres ðŸ–¤ðŸŽ¨</h1>
  <p>Utilisez la souris pour dÃ©placer le "vaisseau" et attraper les lettres dans le bon ordre !</p>

  <script>
    // -- CATEGORIES ET MOTS --
    let wordCategories = {
      animaux: ["chien", "chat", "oiseau", "serpent", "cheval"],
      maison: ["table", "chaise", "lampe", "rideau", "lit"],
      ecole:  ["crayon", "stylo", "gomme", "trousse", "livre"],
      nature: ["arbre", "fleur", "herbe", "montagne", "riviÃ¨re"]
    };

    // -- VARIABLES GLOBALES --
    let currentWord = "";       // Le mot choisi
    let wordArray = [];         // currentWord dÃ©coupÃ© en caractÃ¨res
    let letterColors = [];      // Couleurs associÃ©es Ã  chaque lettre du mot
    let nextLetterIndex = 0;    // Indique la prochaine lettre Ã  attraper dans l'ordre

    // Lettres qui tombent
    let fallingLetters = [];

    // Vaisseau (on le dÃ©place avec la souris)
    let spaceshipY;
    let spaceshipWidth = 60;
    let spaceshipHeight = 20;

    // Etats de jeu : "playing" ou "won"
    let gameState = "playing";

    // -- SETUP p5.js --
    function setup() {
      createCanvas(800, 600);
      textAlign(CENTER, CENTER);

      // Position verticale du vaisseau (on fixe y, x dÃ©pendra de la souris)
      spaceshipY = height - 80;

      resetGame();
    }

    // -- BOUCLE DE DESSIN p5.js --
    function draw() {
      background(240);

      if (gameState === "playing") {
        displayWord();         // Affiche le mot en haut
        displaySpaceship();    // Affiche le Â« vaisseau Â» en bas
        updateFallingLetters(); // Met Ã  jour et affiche les lettres

        // Si on n'a pas encore fini le mot,
        // on fait en sorte qu'il y ait toujours suffisamment de lettres qui tombent.
        if (nextLetterIndex < wordArray.length && fallingLetters.length < 10) {
          spawnLetters(3); 
        }
      } 
      else if (gameState === "won") {
        displayVictory();
      }
    }

    // -- REDEMARRER UNE PARTIE --
    function resetGame() {
      gameState = "playing";
      fallingLetters = [];
      nextLetterIndex = 0;

      // Choisir un nouveau mot alÃ©atoirement
      currentWord = getNextWord();
      // Le transformer en tableau de caractÃ¨res
      wordArray = currentWord.split("");
      // GÃ©nÃ©rer les couleurs (une par caractÃ¨re)
      letterColors = wordArray.map(() => color(random(255), random(255), random(255)));

      // Lancer quelques lettres pour dÃ©marrer
      spawnLetters(5);
    }

    // -- CHOIX ALEATOIRE D'UN MOT --
    function getNextWord() {
      let categories = Object.keys(wordCategories);
      let category = random(categories);
      return random(wordCategories[category]);
    }

    // -- FAIRE APPARAITRE N LETTRES QUI TOMBENT --
    // (parmi le mot et/ou l'alphabet)
    function spawnLetters(n) {
      for (let i = 0; i < n; i++) {
        let dice = random(1);
        let char;

        // 50% de chances de prendre une lettre du mot
        // 50% de chances de prendre une lettre au hasard de l'alphabet
        if (dice < 0.5) {
          char = random(wordArray);
        } else {
          char = random("abcdefghijklmnopqrstuvwxyz");
        }

        fallingLetters.push({
          char: char,
          x: random(width),
          y: random(-300, -50),
          speed: random(1, 2.5),
          color: color(random(255), random(255), random(255))
        });
      }
    }

    // -- AFFICHER LE MOT EN HAUT DE L'ECRAN --
    // Les lettres dÃ©jÃ  validÃ©es (jusqu'Ã  nextLetterIndex) sont en couleur,
    // les lettres restantes sont en noir.
    function displayWord() {
      textSize(32);
      for (let i = 0; i < wordArray.length; i++) {
        if (i < nextLetterIndex) {
          fill(letterColors[i]);
        } else {
          fill(0); // Lettres non collectÃ©es : noir
        }

        // On les aligne en haut, disposÃ©es avec un lÃ©ger espacement
        text(wordArray[i], 100 + i * 40, 50);
      }
    }

    // -- AFFICHER LE VAISSEAU (UN SIMPLE RECTANGLE) EN BAS --
    function displaySpaceship() {
      // On met le "vaisseau" au niveau de la souris en X,
      // mais on le bloque pour qu'il ne sorte pas de l'Ã©cran
      let spaceshipX = constrain(mouseX, spaceshipWidth/2, width - spaceshipWidth/2);

      fill(100);
      rectMode(CENTER);
      rect(spaceshipX, spaceshipY, spaceshipWidth, spaceshipHeight);
    }

    // -- METTRE A JOUR LES LETTRES QUI TOMBENT ET DETECTER LES COLLISIONS --
    function updateFallingLetters() {
      // On utilise la position du "vaisseau" pour checker la collision
      let spaceshipX = constrain(mouseX, spaceshipWidth/2, width - spaceshipWidth/2);

      for (let i = fallingLetters.length - 1; i >= 0; i--) {
        let letter = fallingLetters[i];

        // On dessine la lettre
        fill(letter.color);
        textSize(28);
        text(letter.char, letter.x, letter.y);

        // Elle tombe
        letter.y += letter.speed;

        // Verification de collision avec le vaisseau
        // On considÃ¨re le vaisseau comme un rectangle => test simplifiÃ©
        if (
          letter.x > spaceshipX - spaceshipWidth/2 &&
          letter.x < spaceshipX + spaceshipWidth/2 &&
          letter.y > spaceshipY - spaceshipHeight/2 &&
          letter.y < spaceshipY + spaceshipHeight/2
        ) {
          // On a attrapÃ© la lettre
          fallingLetters.splice(i, 1);

          // VÃ©rifier si c'est la bonne lettre (dans l'ordre)
          // => On compare letter.char avec wordArray[nextLetterIndex]
          if (letter.char === wordArray[nextLetterIndex]) {
            nextLetterIndex++;
            // Si on a rÃ©cupÃ©rÃ© toutes les lettres du mot
            if (nextLetterIndex === wordArray.length) {
              gameState = "won";
              // AprÃ¨s 2 secondes, relancer un mot
              setTimeout(resetGame, 2000);
            }
          }
        }
        // Si la lettre sort de l'Ã©cran, on la retire aussi
        else if (letter.y > height + 50) {
          fallingLetters.splice(i, 1);
        }
      }
    }

    // -- ECRAN DE VICTOIRE --
    function displayVictory() {
      textSize(48);
      fill(0, 200, 0);
      text("Bravo ! ðŸŽ‰", width / 2, height / 2);
    }
  </script>
</body>
</html>








